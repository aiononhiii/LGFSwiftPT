//
//  LGFFreePTTitle.swift
//  LGFSwiftPT
//
//  Created by Êù• on 2019/10/9.
//  Copyright ¬© 2019 laiguofeng. All rights reserved.
//

import UIKit

protocol LGFFreePTTitleDelegate: NSObjectProtocol {
    // MARK: - Âä†ËΩΩ title ÁΩëÁªúÂõæÁâá‰ª£ÁêÜÔºåÂÖ∑‰ΩìÂä†ËΩΩÊ°ÜÊû∂ÊàëÁöÑ Demo ‰∏çÂÅöÁ∫¶ÊùüÔºåËØ∑Ëá™Â∑±ÈÄâÊã©ÂõæÁâáÂä†ËΩΩÊ°ÜÊû∂Ôºå‰ΩøÁî®ÂâçËØ∑ÊâìÂºÄ lgf_IsNetImage
    /**
     imageView Ë¶ÅÂä†ËΩΩÁΩëÁªúÂõæÁâáÁöÑ imageView
     imageUrl ÁΩëÁªúÂõæÁâáÁöÑ Url
     */
    func lgf_GetTitleNetImage(_ imageView: UIImageView, _ imageUrl: URL!)
    // MARK: - ÂÆûÁé∞Ëøô‰∏™‰ª£ÁêÜÊù•ÂØπ LGFFreePTTitle ÁîüÊàêÊó∂Êüê‰∫õÁ≥ªÁªüÂ±ûÊÄßËøõË°åÈÖçÁΩÆ backgroundColor/borderColor/CornerRadiusÁ≠âÁ≠â
    /**
     lgf_FreePTTitle LGFFreePTTitle Êú¨‰Ωì
     index ÊâÄÂú®ÁöÑ index
     style LGFFreePTStyle
     */
    func lgf_GetTitle(_ lgf_FreePTTitle: UIView, _ index: Int, _ style: LGFFreePTStyle)
}

class LGFFreePTTitle: UIView {
    
    weak var lgf_FreePTTitleDelegate: LGFFreePTTitleDelegate?
    
    @IBOutlet weak var lgf_Title: UILabel!// Ê†á
    @IBOutlet weak var lgf_SubTitle: UILabel!// Â≠êÊ†á
    @IBOutlet weak var lgf_TitleWidth: NSLayoutConstraint!// Ê†áÂÆΩÂ∫¶
    @IBOutlet weak var lgf_TitleHeight: NSLayoutConstraint!// Ê†áÈ´òÂ∫¶
    @IBOutlet weak var lgf_SubTitleTop: NSLayoutConstraint!// Â≠êÊ†áÁõ∏ÂØπ‰∫éÊ†áË∑ùÁ¶ª
    @IBOutlet weak var lgf_SubTitleWidth: NSLayoutConstraint!// Ê†áÂÆΩÂ∫¶
    @IBOutlet weak var lgf_SubTitleHeight: NSLayoutConstraint!// Â≠êÊ†áÈ´òÂ∫¶ÔºàÂ≠êÊ†áÂÆΩÂ∫¶ÊöÇÊó∂‰∫éÊ†áÂÖ±‰∫´Âèñ‰∏§ËÄÖMAXÂÄºÔºâ
    @IBOutlet weak var lgf_TitleCenterX: NSLayoutConstraint!// Ê†á‰∏≠ÂøÉX
    @IBOutlet weak var lgf_TitleCenterY: NSLayoutConstraint!// Ê†á‰∏≠ÂøÉY
    
    @IBOutlet weak var lgf_TopImageSpace: NSLayoutConstraint!// Ê†á‰∏äÂõæÁâáÁõ∏ÂØπ‰∫éÊ†áË∑ùÁ¶ª
    @IBOutlet weak var lgf_BottomImageSpace: NSLayoutConstraint!// Ê†á‰∏ãÂõæÁâáÁõ∏ÂØπ‰∫éÊ†áË∑ùÁ¶ª
    @IBOutlet weak var lgf_LeftImageSpace: NSLayoutConstraint!// Ê†áÂ∑¶ÂõæÁâáÁõ∏ÂØπ‰∫éÊ†áË∑ùÁ¶ª
    @IBOutlet weak var lgf_RightImageSpace: NSLayoutConstraint!// Ê†áÂè≥ÂõæÁâáÁõ∏ÂØπ‰∫éÊ†áË∑ùÁ¶ª
    
    @IBOutlet weak var lgf_TopImage: UIImageView!// Ê†á‰∏äÂõæÁâá
    @IBOutlet weak var lgf_TopImageWidth: NSLayoutConstraint!// Ê†á‰∏äÂõæÁâáÂÆΩÂ∫¶
    @IBOutlet weak var lgf_TopImageHeight: NSLayoutConstraint!// Ê†á‰∏äÂõæÁâáÈ´òÂ∫¶
    
    @IBOutlet weak var lgf_BottomImage: UIImageView!// Ê†á‰∏ãÂõæÁâá
    @IBOutlet weak var lgf_BottomImageWidth: NSLayoutConstraint!// Ê†á‰∏ãÂõæÁâáÂÆΩÂ∫¶
    @IBOutlet weak var lgf_BottomImageHeight: NSLayoutConstraint!// Ê†á‰∏ãÂõæÁâáÈ´òÂ∫¶
    
    @IBOutlet weak var lgf_LeftImage: UIImageView!// Ê†áÂ∑¶ÂõæÁâá
    @IBOutlet weak var lgf_LeftImageWidth: NSLayoutConstraint!// Ê†áÂ∑¶ÂõæÁâáÂÆΩÂ∫¶
    @IBOutlet weak var lgf_LeftImageHeight: NSLayoutConstraint!// Ê†áÂ∑¶ÂõæÁâáÈ´òÂ∫¶
    
    @IBOutlet weak var lgf_RightImage: UIImageView!// Ê†áÂè≥ÂõæÁâá
    @IBOutlet weak var lgf_RightImageWidth: NSLayoutConstraint!// Ê†áÂè≥ÂõæÁâáÂÆΩÂ∫¶
    @IBOutlet weak var lgf_RightImageHeight: NSLayoutConstraint!// Ê†áÂè≥ÂõæÁâáÈ´òÂ∫¶
    
    lazy var lgf_SelectImageNames: [String] = []// ÈÄâ‰∏≠ÂõæÁâáÊï∞ÁªÑ
    lazy var lgf_UnSelectImageNames: [String] = []// Êú™ÈÄâ‰∏≠ÂõæÁâáÊï∞ÁªÑ
    
    var lgf_IsHaveImage: Bool = false// ÊòØÂê¶ÊúâÊ†áÂõæÁâá
    var lgf_CurrentTransformSX: CGFloat = 0.0// ÊîæÂ§ßÁº©Â∞èÂÄçÊï∞
    var lgf_MainTitleCurrentTransformSX: CGFloat = 0.0// ‰∏ªÊ†áÈ¢òÊîæÂ§ßÁº©Â∞èÂÄçÊï∞
    var lgf_MainTitleCurrentTransformTY: CGFloat = 0.0// ‰∏ªÊ†áÈ¢ò‰∏ä‰∏ã‰ΩçÁßª
    var lgf_MainTitleCurrentTransformTX: CGFloat = 0.0// ‰∏ªÊ†áÈ¢òÂ∑¶Âè≥‰ΩçÁßª
    var lgf_SubTitleCurrentTransformSX: CGFloat = 0.0// Â≠êÊ†áÈ¢òÊîæÂ§ßÁº©Â∞èÂÄçÊï∞
    var lgf_SubTitleCurrentTransformTY: CGFloat = 0.0// Â≠êÊ†áÈ¢ò‰∏ä‰∏ã‰ΩçÁßª
    var lgf_SubTitleCurrentTransformTX: CGFloat = 0.0// Â≠êÊ†áÈ¢òÂ∑¶Âè≥‰ΩçÁßª
    // Ê†áÂ≠ó‰ΩìÊ∏êÂèòËâ≤Áî®Êï∞ÁªÑ
    lazy var lgf_SelectColorRGBA: [CGFloat] = {
        let (r, g, b, a) = lgf_Style.lgf_TitleSelectColor.lgfpt_Components.rgba
        let arr = [r, g, b, a]
        return arr
    }()
    lazy var lgf_UnSelectColorRGBA: [CGFloat] = {
        let (r, g, b, a) = lgf_Style.lgf_UnTitleSelectColor.lgfpt_Components.rgba
        let arr = [r, g, b, a]
        return arr
    }()
    lazy var lgf_DeltaRGBA: [CGFloat] = {
        let r = lgf_UnSelectColorRGBA[0] - lgf_SelectColorRGBA[0]
        let g = lgf_UnSelectColorRGBA[1] - lgf_SelectColorRGBA[1]
        let b = lgf_UnSelectColorRGBA[2] - lgf_SelectColorRGBA[2]
        let a = lgf_UnSelectColorRGBA[3] - lgf_SelectColorRGBA[3]
        let arr = [r, g, b, a]
        return arr
    }()
    lazy var lgf_SubSelectColorRGBA: [CGFloat] = {
        let (r, g, b, a) = lgf_Style.lgf_SubTitleSelectColor.lgfpt_Components.rgba
        let arr = [r, g, b, a]
        return arr
    }()
    lazy var lgf_SubUnSelectColorRGBA: [CGFloat] = {
        let (r, g, b, a) = lgf_Style.lgf_UnSubTitleSelectColor.lgfpt_Components.rgba
        let arr = [r, g, b, a]
        return arr
    }()
    lazy var lgf_SubDeltaRGBA: [CGFloat] = {
        let r = lgf_SubUnSelectColorRGBA[0] - lgf_SubSelectColorRGBA[0]
        let g = lgf_SubUnSelectColorRGBA[1] - lgf_SubSelectColorRGBA[1]
        let b = lgf_SubUnSelectColorRGBA[2] - lgf_SubSelectColorRGBA[2]
        let a = lgf_SubUnSelectColorRGBA[3] - lgf_SubSelectColorRGBA[3]
        let arr = [r, g, b, a]
        return arr
    }()
    
    weak var lgf_Style: LGFFreePTStyle! {// ÈÖçÁΩÆÁî®Ê®°Âûã
        didSet {
            // Èùû‰∏ªË¶ÅÂ±ûÊÄßÈÖçÁΩÆ
            if lgf_Style.lgf_TitleCornerRadius > 0.0 {
                layer.cornerRadius = lgf_Style.lgf_TitleCornerRadius
                if !clipsToBounds { clipsToBounds = true }
            }
            if lgf_Style.lgf_TitleBorderWidth > 0.0 {
                layer.borderWidth = lgf_Style.lgf_TitleBorderWidth
                layer.borderColor = lgf_Style.lgf_TitleBorderColor.cgColor
                if !clipsToBounds { clipsToBounds = true }
            }
            
            // Ê†á Label ÈÖçÁΩÆ
            lgf_Title.textColor = lgf_Style.lgf_UnTitleSelectColor
            lgf_Title.font = lgf_Style.lgf_UnTitleSelectFont
            lgf_Title.textAlignment = .center
            
            // ÂâØÊ†á Label ÈÖçÁΩÆ
            if (lgf_Style.lgf_IsDoubleTitle) {
                lgf_SubTitle.textColor = lgf_Style.lgf_UnSubTitleSelectColor
                lgf_SubTitle.font = lgf_Style.lgf_UnSubTitleSelectFont
                lgf_SubTitle.textAlignment = .center
            }
            
            // Â¶ÇÊûúËÆæÁΩÆ‰∫ÜÈÉΩÊòØÁõ∏ÂêåÊ†áÂõæÁâá, ÈÇ£‰πàÂ∞±Âº∫Âà∂ËΩ¨ÊàêÂÖ®ÈÉ®Áõ∏ÂêåÂõæÁâá
            if lgf_Style.lgf_SameSelectImageName.count > 0 && lgf_Style.lgf_SameUnSelectImageName.count > 0 {
                lgf_Style.lgf_Titles.forEach {_ in
                    lgf_SelectImageNames.append(lgf_Style.lgf_SameSelectImageName)
                    lgf_UnSelectImageNames.append(lgf_Style.lgf_SameUnSelectImageName)
                }
                lgf_Style.lgf_SelectImageNames = lgf_SelectImageNames
                lgf_Style.lgf_UnSelectImageNames = lgf_UnSelectImageNames
            }
            
            // ÊòØÂê¶ÈúÄË¶ÅÊòæÁ§∫Ê†áÂõæÁâá
            if (lgf_Style.lgf_SelectImageNames.count < lgf_Style.lgf_Titles.count) || (lgf_Style.lgf_UnSelectImageNames.count < lgf_Style.lgf_Titles.count) {
                lgf_IsHaveImage = false
                lgf_TopImage.isHidden = true
                lgf_BottomImage.isHidden = true
                lgf_LeftImage.isHidden = true
                lgf_RightImage.isHidden = true
                lgf_TopImageHeight.constant = 0.0
                lgf_BottomImageHeight.constant = 0.0
                lgf_LeftImageWidth.constant = 0.0
                lgf_RightImageWidth.constant = 0.0
                lgf_TopImageSpace.constant = 0.0
                lgf_BottomImageSpace.constant = 0.0
                lgf_LeftImageSpace.constant = 0.0
                lgf_RightImageSpace.constant = 0.0
                return
            }
            
            lgf_IsHaveImage = true
            
            // Âè™Ë¶ÅÊúâÂÆΩÂ∫¶ÔºåÂÖÅËÆ∏ËÆæÁΩÆÂ∑¶ÂõæÁâá
            if lgf_Style.lgf_LeftImageWidth > 0.0 {
                lgf_LeftImage.isHidden = false
                lgf_LeftImage.contentMode = lgf_Style.lgf_TitleImageContentMode
                lgf_LeftImageSpace.constant = lgf_Style.lgf_LeftImageSpace
                lgf_LeftImageWidth.constant = min(lgf_Style.lgf_LeftImageWidth, lgf_Style.lgf_PVTitleView.lgfpt_Height)
                lgf_LeftImageHeight.constant = min(lgf_Style.lgf_LeftImageHeight, lgf_Style.lgf_PVTitleView.lgfpt_Height)
                if (lgf_Style.lgf_IsNetImage) {
                    lgf_FreePTTitleDelegate?.lgf_GetTitleNetImage(lgf_LeftImage, URL.init(string: lgf_Style.lgf_UnSelectImageNames[tag]))
                } else {
                    lgf_LeftImage.image = UIImage.init(named: lgf_Style.lgf_UnSelectImageNames[tag], in: lgf_Style.lgf_ImageBundel, compatibleWith: nil)
                }
                lgf_TitleCenterX.constant = lgf_TitleCenterX.constant + (lgf_Style.lgf_LeftImageWidth / 2)
                if (lgf_Style.lgf_LeftImageSpace > 0.0) {
                    lgf_TitleCenterX.constant = lgf_TitleCenterX.constant + (lgf_Style.lgf_LeftImageSpace / 2)
                }
            } else {
                debugPrint("ü§ñÔ∏è:Â¶ÇÊûúË¶ÅÊòæÁ§∫Â∑¶ËæπÂõæÊ†áÔºåËØ∑Áªô left_image_width ËµãÂÄº")
            }
            
            // Âè™Ë¶ÅÊúâÂÆΩÂ∫¶ÔºåÂÖÅËÆ∏ËÆæÁΩÆÂè≥ÂõæÁâá
            if (lgf_Style.lgf_RightImageWidth > 0.0) {
                lgf_RightImage.isHidden = false
                lgf_RightImage.contentMode = lgf_Style.lgf_TitleImageContentMode
                lgf_RightImageSpace.constant = lgf_Style.lgf_RightImageSpace
                lgf_RightImageWidth.constant = min(lgf_Style.lgf_RightImageWidth, lgf_Style.lgf_PVTitleView.lgfpt_Height)
                lgf_RightImageHeight.constant = min(lgf_Style.lgf_RightImageHeight, lgf_Style.lgf_PVTitleView.lgfpt_Height)
                if (lgf_Style.lgf_IsNetImage) {
                    lgf_FreePTTitleDelegate?.lgf_GetTitleNetImage(lgf_RightImage, URL.init(string: lgf_Style.lgf_UnSelectImageNames[tag]))
                } else {
                    lgf_RightImage.image = UIImage.init(named: lgf_Style.lgf_UnSelectImageNames[tag], in: lgf_Style.lgf_ImageBundel, compatibleWith: nil)
                }
                lgf_TitleCenterX.constant = lgf_TitleCenterX.constant - (lgf_Style.lgf_RightImageWidth / 2.0)
                if (lgf_Style.lgf_RightImageSpace > 0.0) {
                    lgf_TitleCenterX.constant = lgf_TitleCenterX.constant - (lgf_Style.lgf_RightImageSpace / 2.0)
                }
            } else {
                debugPrint("ü§ñÔ∏è:Â¶ÇÊûúË¶ÅÊòæÁ§∫Âè≥ËæπÂõæÊ†áÔºåËØ∑Áªô right_image_width ËµãÂÄº")
            }
            
            // Âè™Ë¶ÅÊúâÈ´òÂ∫¶ÔºåÂÖÅËÆ∏ËÆæÁΩÆ‰∏äÂõæÁâá
            if (lgf_Style.lgf_TopImageHeight > 0.0) {
                lgf_TopImage.isHidden = false
                lgf_TopImage.contentMode = lgf_Style.lgf_TitleImageContentMode
                lgf_TopImageSpace.constant = lgf_Style.lgf_TopImageSpace
                lgf_TopImageWidth.constant = min(lgf_Style.lgf_TopImageWidth, lgf_Style.lgf_PVTitleView.lgfpt_Width)
                lgf_TopImageHeight.constant = min(lgf_Style.lgf_TopImageHeight, lgf_Style.lgf_PVTitleView.lgfpt_Height)
                if (lgf_Style.lgf_IsNetImage) {
                    lgf_FreePTTitleDelegate?.lgf_GetTitleNetImage(lgf_TopImage, URL.init(string: lgf_Style.lgf_UnSelectImageNames[tag]))
                } else {
                    lgf_TopImage.image = UIImage.init(named: lgf_Style.lgf_UnSelectImageNames[tag], in: lgf_Style.lgf_ImageBundel, compatibleWith: nil)
                }
                lgf_TitleCenterY.constant = lgf_TitleCenterY.constant + (lgf_Style.lgf_TopImageHeight / 2.0)
                if (lgf_Style.lgf_TopImageSpace > 0.0) {
                    lgf_TitleCenterY.constant = lgf_TitleCenterY.constant + (lgf_Style.lgf_TopImageSpace / 2.0)
                }
            } else {
                debugPrint("ü§ñÔ∏è:Â¶ÇÊûúË¶ÅÊòæÁ§∫È°∂ÈÉ®ÂõæÊ†áÔºåËØ∑Áªô top_image_height ËµãÂÄº")
            }
            
            // Âè™Ë¶ÅÊúâÈ´òÂ∫¶ÔºåÂÖÅËÆ∏ËÆæÁΩÆ‰∏ãÂõæÁâá
            if (lgf_Style.lgf_BottomImageHeight > 0.0) {
                lgf_BottomImage.isHidden = false
                lgf_BottomImage.contentMode = lgf_Style.lgf_TitleImageContentMode
                lgf_BottomImageSpace.constant = lgf_Style.lgf_BottomImageSpace
                lgf_BottomImageWidth.constant = min(lgf_Style.lgf_BottomImageWidth, lgf_Style.lgf_PVTitleView.lgfpt_Width)
                lgf_BottomImageHeight.constant = min(lgf_Style.lgf_BottomImageHeight, lgf_Style.lgf_PVTitleView.lgfpt_Height)
                if (lgf_Style.lgf_IsNetImage) {
                    lgf_FreePTTitleDelegate?.lgf_GetTitleNetImage(lgf_BottomImage, URL.init(string: lgf_Style.lgf_UnSelectImageNames[tag]))
                } else {
                    lgf_BottomImage.image = UIImage.init(named: lgf_Style.lgf_UnSelectImageNames[tag], in: lgf_Style.lgf_ImageBundel, compatibleWith: nil)
                }
                lgf_TitleCenterY.constant = lgf_TitleCenterY.constant - (lgf_Style.lgf_BottomImageHeight / 2.0)
                if (lgf_Style.lgf_BottomImageSpace > 0.0) {
                    lgf_TitleCenterY.constant = lgf_TitleCenterY.constant - (lgf_Style.lgf_BottomImageSpace / 2.0)
                }
            } else {
                debugPrint("ü§ñÔ∏è:Â¶ÇÊûúË¶ÅÊòæÁ§∫Â∫ïÈÉ®ÂõæÊ†áÔºåËØ∑Áªô bottom_image_height ËµãÂÄº")
            }
        }
    }
    
    // MARK: - Ê†áÂàùÂßãÂåñ
    /**
     titleText Ê†áÊñáÂ≠ó
     index Âú® LGFFreePT ‰∏≠ÁöÑ‰ΩçÁΩÆ‰∏ãÊ†á
     style ÈÖçÁΩÆÁî®Ê®°Âûã
     @return LGFFreePTTitle
     */
    class func lgf_AllocTitle(_ titleText: String, _ index: Int,_ style: LGFFreePTStyle!, _ delegate: LGFFreePTTitleDelegate) -> LGFFreePTTitle {
        // ÂàùÂßãÂåñÊ†á
        let title = LGFPTBundle.loadNibNamed(String(describing: LGFFreePTTitle.self.classForCoder()), owner: self, options: nil)?.first as! LGFFreePTTitle
        title.tag = index
        title.lgf_FreePTTitleDelegate = delegate
        title.lgf_Style = style
        
        // ÂºÄÂêØË∞ÉËØïÊ®°ÂºèÊâÄÊúâËÉåÊôØÂ∞ÜËÆæÁΩÆÈöèÊú∫È¢úËâ≤Êñπ‰æøË∞ÉËØï
        if title.lgf_Style.lgf_StartDebug {
            title.backgroundColor = UIColor.lgfpt_RandomColor()
            title.lgf_Title.backgroundColor = UIColor.lgfpt_RandomColor()
            title.lgf_SubTitle.backgroundColor = UIColor.lgfpt_RandomColor()
            title.lgf_LeftImage.backgroundColor = UIColor.lgfpt_RandomColor()
            title.lgf_RightImage.backgroundColor = UIColor.lgfpt_RandomColor()
            title.lgf_TopImage.backgroundColor = UIColor.lgfpt_RandomColor()
            title.lgf_BottomImage.backgroundColor = UIColor.lgfpt_RandomColor()
        }
        
        // ÈúÄË¶ÅÊòæÁ§∫Â≠êÊ†áÈ¢ò
        if title.lgf_Style.lgf_IsDoubleTitle {
            title.lgf_Title.text = titleText.components(separatedBy: "~~~").first
            title.lgf_SubTitle.text = titleText.components(separatedBy: "~~~").last
        } else {
            title.lgf_Title.text = titleText
        }
        
        // Ëé∑ÂèñÂ≠ó‰ΩìÂÆΩÂ∫¶
        title.lgf_Title.adjustsFontSizeToFitWidth = true
        let titleSize: CGSize = title.lgf_Title.text?.lgfpt_TextSizeWithFont(font: title.lgf_Style.lgf_TitleSelectFont.pointSize > title.lgf_Style.lgf_UnTitleSelectFont.pointSize ? title.lgf_Style.lgf_TitleSelectFont : title.lgf_Style.lgf_UnTitleSelectFont, constrainedToSize: CGSize.init(width: CGFloat.greatestFiniteMagnitude, height: title.lgf_Style.lgf_PVTitleView.lgfpt_Height)) ?? .zero
        var subTitleSize: CGSize = .zero
        if title.lgf_Style.lgf_IsDoubleTitle {
            title.lgf_SubTitle.adjustsFontSizeToFitWidth = true
            subTitleSize = title.lgf_SubTitle.text?.lgfpt_TextSizeWithFont(font: title.lgf_Style.lgf_SubTitleSelectFont.pointSize > title.lgf_Style.lgf_UnSubTitleSelectFont.pointSize ? title.lgf_Style.lgf_SubTitleSelectFont : title.lgf_Style.lgf_UnSubTitleSelectFont, constrainedToSize: CGSize.init(width: CGFloat.greatestFiniteMagnitude, height: title.lgf_Style.lgf_PVTitleView.lgfpt_Height)) ?? .zero
            title.lgf_SubTitleHeight.constant = subTitleSize.height
            title.lgf_TitleCenterY.constant = title.lgf_TitleCenterY.constant - subTitleSize.height / 2.0 - title.lgf_Style.lgf_SubTitleTopSpace / 2.0
            title.lgf_SubTitleTop.constant = title.lgf_Style.lgf_SubTitleTopSpace
            title.lgf_SubTitleWidth.constant = subTitleSize.width
        }
        title.lgf_TitleWidth.constant = titleSize.width
        title.lgf_TitleHeight.constant = titleSize.height
        
        // Ê†á X
        var titleX: CGFloat = 0.0
        if (index > 0) {
            let subview = title.lgf_Style.lgf_PVTitleView.subviews[index - 1]
            titleX = subview.lgfpt_X + subview.lgfpt_Width
        } else {
            titleX = title.lgf_Style.lgf_PageLeftRightSpace
        }
        
        // Ê†áÂÆΩÂ∫¶
        let maxWidth = max(titleSize.width, subTitleSize.width)
        let totalWidth = (maxWidth + (style.lgf_TitleLeftRightSpace * 2.0) + title.lgf_Style.lgf_LeftImageWidth + title.lgf_Style.lgf_RightImageWidth + title.lgf_Style.lgf_LeftImageSpace + title.lgf_Style.lgf_RightImageSpace)
        let titleWidth = title.lgf_Style.lgf_TitleFixedWidth > 0.0 ? title.lgf_Style.lgf_TitleFixedWidth : totalWidth
        title.frame = CGRect.init(x: titleX, y: 0.0, width: titleWidth, height: title.lgf_Style.lgf_PVTitleView.lgfpt_Height)
        title.lgf_Style.lgf_PVTitleView.addSubview(title)
        
        // Ê†πÊçÆÁâπÊÆä title Êï∞ÁªÑ Âíå ÁâπÊÆä title ÁöÑ tag Âà§Êñ≠Êüê‰∏™ index ÊòØÂê¶Ë¶ÅÊõøÊç¢ÁâπÊÆä title
        if style.lgf_FreePTSpecialTitleArray.count > 0 {
            style.lgf_FreePTSpecialTitleArray.forEach {
                let propertyArray = $0.lgf_FreePTSpecialTitleProperty?.components(separatedBy: "~~~")
                if propertyArray!.count == 2 {
                    let specialTitleIndex = Int(propertyArray!.first ?? "0")
                    if index == specialTitleIndex {
                        title.subviews.forEach { $0.removeFromSuperview() }
                        title.lgfpt_Width = CGFloat(Int(propertyArray!.last ?? "0") ?? 0)
                        $0.frame = title.bounds
                        title.addSubview($0)
                    }
                }
            }
        }
        // Ëøô‰∏™‰ª£ÁêÜÊîæÂú®ÊúÄ‰∏ãÈù¢ÔºåÂØπ‰∏Ä‰∫õ LGFFreePTStyle ÈÖçÁΩÆÁöÑÂ±ûÊÄßÊã•ÊúâÊúÄÁªà‰øÆÊîπÊùÉ
        title.lgf_FreePTTitleDelegate?.lgf_GetTitle(title, index, style)
        return title
    }
    
    // MARK: - Ê†áÊï¥‰ΩìÁä∂ÊÄÅÊîπÂèò Ê†∏ÂøÉÈÄªËæëÈÉ®ÂàÜ
    /**
     progress Â§ñÈÉ® progress
     isSelectTitle ÊòØÂê¶ÊòØË¶ÅÈÄâ‰∏≠ÁöÑ LGFFreePTTitle
     selectIndex ÈÄâ‰∏≠ÁöÑ index
     unselectIndex Êú™ÈÄâ‰∏≠ÁöÑ index
     */
    func lgf_SetMainTitleTransform(_ progress: CGFloat, _ isSelectTitle: Bool, _ selectIndex: Int, _ unselectIndex: Int) {
        let deltaScale = lgf_Style.lgf_TitleTransformSX - 1.0
        let mainTitleDeltaScale = lgf_Style.lgf_MainTitleTransformSX - 1.0
        let subTitleDeltaScale = lgf_Style.lgf_SubTitleTransformSX - 1.0
        
        if isSelectTitle {
            lgf_CurrentTransformSX = 1.0 + deltaScale * progress
            lgf_MainTitleCurrentTransformSX = 1.0 + mainTitleDeltaScale * progress
            lgf_MainTitleCurrentTransformTY = lgf_Style.lgf_MainTitleTransformTY * progress
            lgf_MainTitleCurrentTransformTX = lgf_Style.lgf_MainTitleTransformTX * progress
            lgf_SubTitleCurrentTransformSX = 1.0 + subTitleDeltaScale * progress
            lgf_SubTitleCurrentTransformTY = lgf_Style.lgf_SubTitleTransformTY * progress
            lgf_SubTitleCurrentTransformTX = lgf_Style.lgf_SubTitleTransformTX * progress
        } else {
            lgf_CurrentTransformSX = lgf_Style.lgf_TitleTransformSX - deltaScale * progress
            lgf_MainTitleCurrentTransformSX = lgf_Style.lgf_MainTitleTransformSX - mainTitleDeltaScale * progress
            lgf_MainTitleCurrentTransformTY = lgf_Style.lgf_MainTitleTransformTY - lgf_Style.lgf_MainTitleTransformTY * progress
            lgf_MainTitleCurrentTransformTX = lgf_Style.lgf_MainTitleTransformTX - lgf_Style.lgf_MainTitleTransformTX * progress
            lgf_SubTitleCurrentTransformSX = lgf_Style.lgf_SubTitleTransformSX - subTitleDeltaScale * progress
            lgf_SubTitleCurrentTransformTY = lgf_Style.lgf_SubTitleTransformTY - lgf_Style.lgf_SubTitleTransformTY * progress
            lgf_SubTitleCurrentTransformTX = lgf_Style.lgf_SubTitleTransformTX - lgf_Style.lgf_SubTitleTransformTX * progress
        }
        
        transform = CGAffineTransform.init(scaleX: lgf_CurrentTransformSX, y: lgf_CurrentTransformSX)
        lgf_Title.transform = CGAffineTransform.identity
        lgf_Title.transform = CGAffineTransform.init(scaleX: lgf_MainTitleCurrentTransformSX, y: lgf_MainTitleCurrentTransformSX)
        lgf_Title.transform = lgf_Title.transform.translatedBy(x: lgf_MainTitleCurrentTransformTX, y: lgf_MainTitleCurrentTransformTY)
        
        lgf_SubTitle.transform = CGAffineTransform.identity
        lgf_SubTitle.transform = CGAffineTransform.init(scaleX: lgf_SubTitleCurrentTransformSX, y: lgf_SubTitleCurrentTransformSX)
        lgf_SubTitle.transform = lgf_SubTitle.transform.translatedBy(x: lgf_SubTitleCurrentTransformTX, y: lgf_SubTitleCurrentTransformTY)
        
        // Ê†áÈ¢úËâ≤Ê∏êÂèò
        if lgf_Style.lgf_TitleSelectColor != lgf_Style.lgf_UnTitleSelectColor {
            let colors = isSelectTitle ? lgf_UnSelectColorRGBA : lgf_SelectColorRGBA
            lgf_Title.textColor = UIColor.init(red: colors[0] - (isSelectTitle ? lgf_DeltaRGBA[0] : -lgf_DeltaRGBA[0]) * progress, green: colors[1] - (isSelectTitle ? lgf_DeltaRGBA[1] : -lgf_DeltaRGBA[1]) * progress, blue: colors[2] - (isSelectTitle ? lgf_DeltaRGBA[2] : -lgf_DeltaRGBA[2]) * progress, alpha: colors[3] - (isSelectTitle ? lgf_DeltaRGBA[3] : -lgf_DeltaRGBA[3]) * progress)
        }
        if lgf_Style.lgf_IsDoubleTitle && lgf_Style.lgf_SubTitleSelectColor != lgf_Style.lgf_UnSubTitleSelectColor {
            let colors = isSelectTitle ? lgf_SubUnSelectColorRGBA : lgf_SubSelectColorRGBA
            lgf_SubTitle.textColor = UIColor.init(red: colors[0] - (isSelectTitle ? lgf_SubDeltaRGBA[0] : -lgf_SubDeltaRGBA[0]) * progress, green: colors[1] - (isSelectTitle ? lgf_SubDeltaRGBA[1] : -lgf_SubDeltaRGBA[1]) * progress, blue: colors[2] - (isSelectTitle ? lgf_SubDeltaRGBA[2] : -lgf_SubDeltaRGBA[2]) * progress, alpha: colors[3] - (isSelectTitle ? lgf_SubDeltaRGBA[3] : -lgf_SubDeltaRGBA[3]) * progress)
        }
        
        // Â≠ó‰ΩìÊîπÂèò
        if !(lgf_Style.lgf_TitleSelectFont == lgf_Style.lgf_UnTitleSelectFont) {
            lgf_Title.font = (isSelectTitle == (progress > 0.5)) ? lgf_Style.lgf_TitleSelectFont : lgf_Style.lgf_UnTitleSelectFont
        }
        if lgf_Style.lgf_IsDoubleTitle {
            if !(lgf_Style.lgf_SubTitleSelectFont == lgf_Style.lgf_UnSubTitleSelectFont) {
                lgf_SubTitle.font = (isSelectTitle == (progress > 0.5)) ? lgf_Style.lgf_SubTitleSelectFont : lgf_Style.lgf_UnSubTitleSelectFont
            }
        }
        
        // ÂõæÊ†áÈÄâ‰∏≠
        if lgf_Style.lgf_SelectImageNames.count > 0 && lgf_Style.lgf_UnSelectImageNames.count > 0 {
            let ssImageName = lgf_Style.lgf_SelectImageNames[selectIndex]
            let uuImageName = lgf_Style.lgf_UnSelectImageNames[unselectIndex]
            let usImageName = lgf_Style.lgf_UnSelectImageNames[selectIndex]
            let suImageName = lgf_Style.lgf_SelectImageNames[unselectIndex]
            let imageName = (isSelectTitle ? (progress > 0.5 ? ssImageName : usImageName) : (progress > 0.5 ? uuImageName : suImageName))
            if lgf_Style.lgf_LeftImageWidth > 0.0 && lgf_Style.lgf_LeftImageHeight > 0.0 {
                if lgf_Style.lgf_IsNetImage {
                    lgf_FreePTTitleDelegate?.lgf_GetTitleNetImage(lgf_LeftImage, URL.init(string: imageName))
                } else {
                    lgf_LeftImage.image = UIImage.init(named: imageName, in: lgf_Style.lgf_ImageBundel, compatibleWith: nil)
                }
            }
            if lgf_Style.lgf_RightImageWidth > 0.0 && lgf_Style.lgf_RightImageHeight > 0.0 {
                if lgf_Style.lgf_IsNetImage {
                    lgf_FreePTTitleDelegate?.lgf_GetTitleNetImage(lgf_RightImage, URL.init(string: imageName))
                } else {
                    lgf_RightImage.image = UIImage.init(named: imageName, in: lgf_Style.lgf_ImageBundel, compatibleWith: nil)
                }
            }
            if lgf_Style.lgf_TopImageHeight > 0.0 && lgf_Style.lgf_TopImageWidth > 0.0 {
                if lgf_Style.lgf_IsNetImage {
                    lgf_FreePTTitleDelegate?.lgf_GetTitleNetImage(lgf_TopImage, URL.init(string: imageName))
                } else {
                    lgf_TopImage.image = UIImage.init(named: imageName, in: lgf_Style.lgf_ImageBundel, compatibleWith: nil)
                }
            }
            if lgf_Style.lgf_BottomImageHeight > 0.0 && lgf_Style.lgf_BottomImageWidth > 0.0 {
                if lgf_Style.lgf_IsNetImage {
                    lgf_FreePTTitleDelegate?.lgf_GetTitleNetImage(lgf_BottomImage, URL.init(string: imageName))
                } else {
                    lgf_BottomImage.image = UIImage.init(named: imageName, in: lgf_Style.lgf_ImageBundel, compatibleWith: nil)
                }
            }
        }
    }
    
}
